<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.15" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #22272e;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (userMode === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (userMode === 'dark' || systemDarkMode) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <title>Grammar-Kit | Khaled Hammouda</title><meta name="description" content="Building a 64-bit operating system from scratch in Nim">
    <link rel="preload" href="/assets/style-DFReAQZD.css" as="style"><link rel="stylesheet" href="/assets/style-DFReAQZD.css">
    <link rel="modulepreload" href="/assets/app-BEnvQN0t.js"><link rel="modulepreload" href="/assets/07-grammarkit.html-DALOmYeT.js">
    <link rel="prefetch" href="/assets/index.html-DN4baEjd.js" as="script"><link rel="prefetch" href="/assets/index.html-DTcVMSat.js" as="script"><link rel="prefetch" href="/assets/01-mm.html-DdVm3GHI.js" as="script"><link rel="prefetch" href="/assets/index.html-D8_cVHQe.js" as="script"><link rel="prefetch" href="/assets/01-intro.html-Bq4FSDwn.js" as="script"><link rel="prefetch" href="/assets/02-setup.html-9f0UzP9I.js" as="script"><link rel="prefetch" href="/assets/03-filetype.html-DVtyN252.js" as="script"><link rel="prefetch" href="/assets/04-lexer.html-OooGwppm.js" as="script"><link rel="prefetch" href="/assets/05-parser.html-Dw5HPOU5.js" as="script"><link rel="prefetch" href="/assets/06-parser-p2.html-CHLJtldD.js" as="script"><link rel="prefetch" href="/assets/08-go-to-decl.html-DPftLCwO.js" as="script"><link rel="prefetch" href="/assets/09-scopes.html-BhA3Jfl5.js" as="script"><link rel="prefetch" href="/assets/10-rename-refactoring.html-CQ7xy6Op.js" as="script"><link rel="prefetch" href="/assets/11-indentation.html-BSbVKVoe.js" as="script"><link rel="prefetch" href="/assets/12-decl-sections.html-DM3D0T_j.js" as="script"><link rel="prefetch" href="/assets/13-comments.html-PACjUQ8Q.js" as="script"><link rel="prefetch" href="/assets/14-numeric-lit.html-Bx-wwqk6.js" as="script"><link rel="prefetch" href="/assets/15-expressions.html-26eNyM4d.js" as="script"><link rel="prefetch" href="/assets/99-tmp.html-gvMZWEF9.js" as="script"><link rel="prefetch" href="/assets/index.html-J4FG-UC7.js" as="script"><link rel="prefetch" href="/assets/01-intro.html-BeNfzmF-.js" as="script"><link rel="prefetch" href="/assets/02-environment-setup.html-C8XAFCUU.js" as="script"><link rel="prefetch" href="/assets/03-targeting-uefi-p1.html-C9weobAl.js" as="script"><link rel="prefetch" href="/assets/04-targeting-uefi-p2.html-DtpCSkF_.js" as="script"><link rel="prefetch" href="/assets/05-bootloader-p1.html-nF5TI7gq.js" as="script"><link rel="prefetch" href="/assets/06-bootloader-p2.html-lTW7xvyF.js" as="script"><link rel="prefetch" href="/assets/07-kernel-image.html-Dbec7FcX.js" as="script"><link rel="prefetch" href="/assets/08-loading-the-kernel-p1.html-CgEWrWCh.js" as="script"><link rel="prefetch" href="/assets/09-loading-the-kernel-p2.html-Bsyq9hJE.js" as="script"><link rel="prefetch" href="/assets/10-loading-the-kernel-p3.html-Cz6f791z.js" as="script"><link rel="prefetch" href="/assets/11-physical-memory.html-Iko_lfyH.js" as="script"><link rel="prefetch" href="/assets/12-virtual-memory.html-BdHdqaeH.js" as="script"><link rel="prefetch" href="/assets/13-higher-half-kernel.html-U7sLCIG_.js" as="script"><link rel="prefetch" href="/assets/14-memory-segments.html-C0Wfonfg.js" as="script"><link rel="prefetch" href="/assets/15-interrupts.html-CuXOHXlP.js" as="script"><link rel="prefetch" href="/assets/16-user-mode.html-DI-QEaJn.js" as="script"><link rel="prefetch" href="/assets/17-tss.html-DedksTv0.js" as="script"><link rel="prefetch" href="/assets/18-system-calls.html-CANG8AhC.js" as="script"><link rel="prefetch" href="/assets/19-tasks.html-D_KA9R1n.js" as="script"><link rel="prefetch" href="/assets/20-position-independent-code.html-DcxhRHAD.js" as="script"><link rel="prefetch" href="/assets/21-elf-loader-p1.html-hRqOVejE.js" as="script"><link rel="prefetch" href="/assets/22-elf-loader-p2.html-CwKLac9X.js" as="script"><link rel="prefetch" href="/assets/23-coop-multitasking.html-CmjVNMNt.js" as="script"><link rel="prefetch" href="/assets/24-system-library.html-Chl8ifRh.js" as="script"><link rel="prefetch" href="/assets/25-interrupt-controller.html-i_QNpPOS.js" as="script"><link rel="prefetch" href="/assets/index.html--jTsfqNO.js" as="script"><link rel="prefetch" href="/assets/404.html-CYnd4SKg.js" as="script"><link rel="prefetch" href="/assets/SearchResult-ZUCfC4Sv.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/"><!----><span class="vp-site-name" aria-hidden="true">Khaled Hammouda</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/" aria-label="Home"><!---->Home<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/osdev/" aria-label="Fusion OS"><!---->Fusion OS<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/acronyms/" aria-label="Computing Acronyms"><!---->Computing Acronyms<!----></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!--[--><button type="button" class="search-pro-button" aria-label="Search"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon" name="search"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">Search</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/" aria-label="Home"><!---->Home<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/osdev/" aria-label="Fusion OS"><!---->Fusion OS<!----></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/acronyms/" aria-label="Computing Acronyms"><!---->Computing Acronyms<!----></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><a class="route-link route-link-active auto-link vp-sidebar-item vp-sidebar-heading active" href="/nimjet/" aria-label="NimJet"><!---->NimJet<!----></a><ul class="vp-sidebar-children" style=""><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/nimjet/01-intro" aria-label="Introduction"><!---->Introduction<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/nimjet/02-setup" aria-label="Project Setup"><!---->Project Setup<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/nimjet/03-filetype" aria-label="File Type"><!---->File Type<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/nimjet/04-lexer" aria-label="Lexer"><!---->Lexer<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/nimjet/05-parser" aria-label="Parser"><!---->Parser<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/nimjet/06-parser-p2" aria-label="Parser Implementation"><!---->Parser Implementation<!----></a><!----></li><li><a class="route-link route-link-active auto-link vp-sidebar-item active" href="/nimjet/07-grammarkit" aria-label="Grammar-Kit"><!---->Grammar-Kit<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/nimjet/08-go-to-decl" aria-label="Go To Declaration"><!---->Go To Declaration<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/nimjet/09-scopes" aria-label="Scope Resolution"><!---->Scope Resolution<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/nimjet/10-rename-refactoring" aria-label="Rename Refactoring"><!---->Rename Refactoring<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/nimjet/11-indentation" aria-label="Indentation"><!---->Indentation<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/nimjet/12-decl-sections" aria-label="Declaration Sections"><!---->Declaration Sections<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/nimjet/13-comments" aria-label="Comments"><!---->Comments<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/nimjet/14-numeric-lit" aria-label="Numeric Literals"><!---->Numeric Literals<!----></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/nimjet/15-expressions" aria-label="Expressions"><!---->Expressions<!----></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div class="theme-default-content" vp-content><!--[--><!--]--><div><h1 id="grammar-kit" tabindex="-1"><a class="header-anchor" href="#grammar-kit"><span>Grammar-Kit</span></a></h1><p>Grammar-Kit is a JetBrains plugin for generating a parser (and a lexer, if needed) from a grammar specification file that uses a BNF-like syntax. Not only does it generate the parser, but it also generates the PSI classes of the language. This is a huge time-saver, as it allows us to focus on the language syntax and semantics rather than the parsing details.</p><h2 id="the-bnf-file" tabindex="-1"><a class="header-anchor" href="#the-bnf-file"><span>The BNF File</span></a></h2><p>The grammar specification file is written in a BNF-like syntax. The file two types of sections: an <strong>attributes</strong> section and a <strong>grammar rules</strong> section. The attributes section allows us to customize the generated parser and PSI classes, while the grammar rules section defines the language syntax. Here&#39;s a simple example of such a BNF file:</p><div class="language-bnf line-numbers-mode" data-highlighter="prismjs" data-ext="bnf" data-title="bnf"><pre><code><span class="line">// Attributes</span>
<span class="line"><span class="token operator">{</span></span>
<span class="line">  parserClass=<span class="token string">&quot;generated.MyParser&quot;</span></span>
<span class="line"><span class="token operator">}</span></span>
<span class="line"></span>
<span class="line">// Grammar</span>
<span class="line">Root      <span class="token operator">::=</span> BEGIN <span class="token operator">(</span>MyStmt SEMI<span class="token operator">)</span><span class="token operator">*</span> END</span>
<span class="line">MyStmt    <span class="token operator">::=</span> PrintStmt</span>
<span class="line">            <span class="token operator">|</span> <span class="token operator">...</span></span>
<span class="line">PrintStmt <span class="token operator">::=</span> PRINT STRING_LIT</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>In the attributes section we specified the fully qualified name of the parser class that will be generated. In the grammar section, we defined the syntax of a simple language that consists of a <code>BEGIN</code> keyword followed by a sequence of statements separated by semicolons (the <code>SEMI</code> token), and ending with an <code>END</code> keyword. The <code>PrintStmt</code> rule defines a statement that consists of a <code>PRINT</code> keyword followed by a string literal.</p><p>There are no restrictions on the names of the rules or the tokens, but here I&#39;m adopting the following convention:</p><ul><li>Rule names are in <code>PascalCase</code> (those are intermediate nodes in the AST)</li><li>Token names are in <code>UPPER_SNAKE_CASE</code> (those are leaf nodes in the AST)</li></ul><h2 id="generating-the-parser" tabindex="-1"><a class="header-anchor" href="#generating-the-parser"><span>Generating the Parser</span></a></h2><p>To generate the parser, we can right-click on the grammar file and select the <strong>Generate Parser Code</strong> action. This will generate the parser and lexer classes under the <code>src/main/gen</code> directory (as opposed to the <code>src/main/kotlin</code> directory where we have our handwritten code). By default, Grammar-Kit generates the following set of classes:</p><div class="language-tree line-numbers-mode" data-highlighter="prismjs" data-ext="tree" data-title="tree"><pre><code><span class="line">src/main/gen</span>
<span class="line">└── generated</span>
<span class="line">    ├── psi</span>
<span class="line">    │   ├── impl</span>
<span class="line">    │   │   ├── MyStmtImpl.java</span>
<span class="line">    │   │   └── PrintStmtImpl.java</span>
<span class="line">    │   ├── MyStmt.java</span>
<span class="line">    │   ├── PrintStmt.java</span>
<span class="line">    │   └── Visitor.java</span>
<span class="line">    ├── MyParser.java</span>
<span class="line">    └── GeneratedTypes.java</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>For PSI, Grammar-Kit generates pairs of interfaces and implementation classes for each rule in the grammar. For example, the <code>PrintStmt</code> rule will have an interface <code>PrintStmt</code> and an implementation class <code>PrintStmtImpl</code>. The <code>Visitor</code> interface is used to traverse the PSI tree, and the <code>GeneratedTypes</code> class contains the token and rule element types (extending <code>IElementType</code>). It also contains an inner <code>Factory</code> class with a single method <code>createElement</code> that creates the appropriate PSI element for a given AST node (used by the <code>ParserDefinition.createElement()</code> method to create PSI elements).</p><p>We can also ask Grammar-Kit to generate a lexer for us by right-clicking on the grammar file and selecting the <strong>Generate JFlex Lexer</strong> action. This will generate the lexer specification file, but we have to select the location where we want to save it - let&#39;s say we save it under <code>src/main/gen/generated</code> as <code>MyLexer.flex</code> (alongside the generated parser and PSI). Now we can right-click on the lexer file and select the <strong>Run JFlex Generator</strong> action, which will generate the lexer class <code>MyLexer</code> under the <code>src/main/gen/generated</code> directory. So, in addition to the above files, we will have:</p><div class="language-tree line-numbers-mode" data-highlighter="prismjs" data-ext="tree" data-title="tree"><pre><code><span class="line">src/main/gen</span>
<span class="line">└── generated</span>
<span class="line">    ├── ...</span>
<span class="line">    ├── MyLexer.flex</span>
<span class="line">    └── MyLexer.java</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>While generating the lexer is convenient, it is not flexible enough for complex languages that require custom lexing rules (like Nim). So, we will keep our handwritten lexer and tokens, and tell Grammar-Kit to use them instead.</p><p>We also won&#39;t need a visitor class for now, so we&#39;ll tell Grammar-Kit not to generate it as well.</p><h2 id="a-simple-nim-bnf" tabindex="-1"><a class="header-anchor" href="#a-simple-nim-bnf"><span>A Simple Nim BNF</span></a></h2><p>Let&#39;s create a BNF file for Nim that would parse the <code>echo &quot;hello, world&quot;</code> statement that we used in the previous sections.</p><div class="language-bnf line-numbers-mode" data-highlighter="prismjs" data-ext="bnf" data-title="bnf"><pre><code><span class="line"><span class="token operator">{</span></span>
<span class="line">    generate=<span class="token operator">[</span>tokens=<span class="token string">&quot;no&quot;</span> visitor=<span class="token string">&quot;no&quot;</span><span class="token operator">]</span></span>
<span class="line"></span>
<span class="line">    parserClass=<span class="token string">&quot;khaledh.nimjet.parser.NimParser&quot;</span></span>
<span class="line">    parserImports=<span class="token string">&quot;static khaledh.nimjet.lexer.NimToken.*&quot;</span></span>
<span class="line"></span>
<span class="line">    elementTypeClass=<span class="token string">&quot;khaledh.nimjet.parser.NimElementType&quot;</span></span>
<span class="line">    elementTypeHolderClass=<span class="token string">&quot;khaledh.nimjet.parser.NimElement&quot;</span></span>
<span class="line"></span>
<span class="line">    psiPackage=<span class="token string">&quot;khaledh.nimjet.psi&quot;</span></span>
<span class="line">    psiImplPackage=<span class="token string">&quot;khaledh.nimjet.psi.impl&quot;</span></span>
<span class="line"><span class="token operator">}</span></span>
<span class="line"></span>
<span class="line">Root    <span class="token operator">::=</span> !&lt;<span class="token rule"><span class="token punctuation">&lt;</span>eof<span class="token punctuation">&gt;</span></span>&gt; NimStmt</span>
<span class="line">NimStmt <span class="token operator">::=</span> IDENTIFIER STRING_LIT</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>In the attributes section, we specified:</p><ul><li>that we don&#39;t want Grammar-Kit to generate tokens or a visitor class</li><li>the fully qualified name of the <code>NimParser</code> class that will be generated</li><li>the parser imports that we need, which are the token types from our lexer</li><li>the fully qualified name of the element type class <code>NimElementType</code> that we created previously; Grammar-Kit will use this class to create instances of the AST element types</li><li>the class that will hold the instances of the element types: <code>NimElement</code></li><li>the package names for the PSI and PSI implementation classes</li></ul><p>In the grammar section, we defined the syntax of a simple Nim file that consists of a single statement, which is an identifier followed by a string literal.</p><p>Notice the <code>!&lt;&lt;eof&gt;&gt;</code> syntax in the <code>Root</code> rule. The <code>&lt;&lt;...&gt;&gt;</code> syntax is used to invoke an external rule defined in parser, which in this case is the built-in <code>eof</code> rule that matches the end of the file. The <code>!</code> operator negates the rule, so having <code>!&lt;&lt;eof&gt;&gt;</code> at the beginning of the <code>Root</code> rule won&#39;t match an empty file. This prevents the parser from generating an error when the file is empty.</p><h2 id="generating-the-nim-parser" tabindex="-1"><a class="header-anchor" href="#generating-the-nim-parser"><span>Generating the Nim Parser</span></a></h2><p>Now we can right-click on the Nim BNF file and select the <strong>Generate Parser Code</strong> action to generate the parser classes. We will end up with the following set of classes:</p><div class="language-tree line-numbers-mode" data-highlighter="prismjs" data-ext="tree" data-title="tree"><pre><code><span class="line">src/main/gen</span>
<span class="line">└── khaledh/nimjet</span>
<span class="line">    ├── parser</span>
<span class="line">    │   ├── NimElement.java</span>
<span class="line">    │   └── NimParser.java</span>
<span class="line">    └── psi</span>
<span class="line">        ├── impl</span>
<span class="line">        │   └── NimStmtImpl.java</span>
<span class="line">        └── NimStmt.java</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Our handwritten part of the parser should be structured as follows, under the <code>src/main/kotlin</code> directory:</p><div class="language-tree line-numbers-mode" data-highlighter="prismjs" data-ext="tree" data-title="tree"><pre><code><span class="line">src/main/kotlin</span>
<span class="line">└── khaledh/nimjet</span>
<span class="line">    ...</span>
<span class="line">    ├── parser</span>
<span class="line">    │   ├── Nim.bnf</span>
<span class="line">    │   ├── NimElementType.kt</span>
<span class="line">    │   └── NimParserDefinition.kt</span>
<span class="line">    └── psi</span>
<span class="line">        └── NimFile.kt    </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>And to complete the organization, we should have the lexer and the various language plugin classes also tidied up as follows:</p><div class="language-tree line-numbers-mode" data-highlighter="prismjs" data-ext="tree" data-title="tree"><pre><code><span class="line">src/main/kotlin</span>
<span class="line">└── khaledh/nimjet</span>
<span class="line">    ├── lang</span>
<span class="line">    │   ├── NimFileType.kt</span>
<span class="line">    │   ├── NimIcons.kt</span>
<span class="line">    │   └── NimLanguage.kt</span>
<span class="line">    ├── lexer</span>
<span class="line">    │   ├── Nim.flex</span>
<span class="line">    │   ├── NimLexerAdapter.java</span>
<span class="line">    │   ├── NimToken.kt</span>
<span class="line">    │   └── NimTokenType.kt</span>
<span class="line">    ├── parser</span>
<span class="line">    │   ...</span>
<span class="line">    └── psi</span>
<span class="line">        ...</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>If we test the plugin now, we should have the same functionality as before, but with the parser generated by Grammar-Kit in this case. As a final step, let&#39;s automate generating the parser using the Gradle build script, as we did with the lexer.</p><div class="language-kts line-numbers-mode" data-highlighter="prismjs" data-ext="kts" data-title="kts"><pre><code><span class="line"><span class="token comment">// build.gradle.kts</span></span>
<span class="line"><span class="token operator">..</span><span class="token punctuation">.</span></span>
<span class="line"></span>
<span class="line">tasks <span class="token punctuation">{</span></span>
<span class="line">    generateLexer <span class="token punctuation">{</span></span>
<span class="line">        <span class="token operator">..</span><span class="token punctuation">.</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line highlighted">    generateParser <span class="token punctuation">{</span></span>
<span class="line highlighted">        sourceFile <span class="token operator">=</span> <span class="token function">file</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;src/main/kotlin/khaledh/nimjet/parser/Nim.bnf&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line highlighted">        targetRootOutputDir <span class="token operator">=</span> <span class="token function">file</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;src/main/gen&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line highlighted">        pathToParser <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;khaledh/nimjet/parser/NimParser.java&quot;</span></span></span>
<span class="line highlighted">        pathToPsiRoot <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;khaledh/nimjet/psi&quot;</span></span></span>
<span class="line highlighted">        purgeOldFiles <span class="token operator">=</span> <span class="token boolean">true</span></span>
<span class="line highlighted">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    compileJava <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">dependsOn</span><span class="token punctuation">(</span>generateLexer<span class="token punctuation">)</span></span>
<span class="line highlighted">        <span class="token function">dependsOn</span><span class="token punctuation">(</span>generateParser<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    compileKotlin <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">dependsOn</span><span class="token punctuation">(</span>generateLexer<span class="token punctuation">)</span></span>
<span class="line highlighted">        <span class="token function">dependsOn</span><span class="token punctuation">(</span>generateParser<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This should take care of generating the parser whenever we build the project, so we don&#39;t have to manually run the Grammar-Kit action every time we change the BNF file (unless we need to inspect the generated code, of course).</p></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><!----></div></footer><nav class="vp-page-nav" aria-label="page navigation"><a class="route-link auto-link prev" href="/nimjet/06-parser-p2" aria-label="Parser Implementation"><div class="hint"><span class="arrow left"></span> Prev</div><div class="link"><span>Parser Implementation</span></div></a><a class="route-link auto-link next" href="/nimjet/08-go-to-decl" aria-label="Go To Declaration"><div class="hint">Next <span class="arrow right"></span></div><div class="link"><span>Go To Declaration</span></div></a></nav><!--[--><!--]--></main><!--]--></div><!--[--><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-BEnvQN0t.js" defer></script>
  </body>
</html>

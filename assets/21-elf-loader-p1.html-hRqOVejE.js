import{_ as s,c as a,e,o as p}from"./app-BEnvQN0t.js";const t={};function l(o,n){return p(),a("div",null,[...n[0]||(n[0]=[e(`<h1 id="elf-loader-part-1" tabindex="-1"><a class="header-anchor" href="#elf-loader-part-1"><span>ELF Loader (Part 1)</span></a></h1><p>So far we used a flat binary format for our user task. But it&#39;s becoming more difficult as we have to manually specify the layout of the binary using a linker script, and arrange the sections in a fixed way so that the kernel can load them, apply relocations, and jump to the entry point. We also haven&#39;t told the kernel what sections should be marked as read-only, read-write, and/or executable. This is where the ELF format comes in.</p><p>ELF is a self-describing format that contains all the information needed to load and run a program. Although implementing an ELF loader is more complex than a flat binary loader, it&#39;s more flexible and will save us a lot of time in the long run. Let&#39;s go ahead and implement an ELF loader.</p><h2 id="elf-format" tabindex="-1"><a class="header-anchor" href="#elf-format"><span>ELF Format</span></a></h2><p>ELF files contain executable code and data, as well as metadata about the file so that the loader can load the file into memory and run it. The parts of the ELF format that are relevant to us are:</p><dl><dt><strong>ELF Header</strong></dt><dd>Contains metadata about the file, such as the target architecture, the entry point, and the offsets of the other sections.</dd><dt><strong>Program Header Table</strong></dt><dd>Contains a list of segments to be loaded into memory. Each segment can contain one or more sections.</dd><dt><strong>Section Header Table</strong></dt><dd>Contains a list of sections, which are used for debugging and linking.</dd><dt><strong>Sections</strong></dt><dd>Contains the actual code and data of the program.</dd><dt><strong>Symbol Table</strong></dt><dd>Contains information about the symbols in the program.</dd><dt><strong>String Table</strong></dt><dd>Contains strings used by the symbol table.</dd><dt><strong>Relocation Table</strong></dt><dd>Contains information about the relocations to be applied to the program.</dd></dl><h2 id="building-an-elf-binary" tabindex="-1"><a class="header-anchor" href="#building-an-elf-binary"><span>Building an ELF binary</span></a></h2><p>Let&#39;s modify our user program to build an ELF binary instead of a flat binary. We previously used a linker script to have control over the binary layout, such that the kernel could load the binary in a straightforward way. To produce an ELF binary, we&#39;ll simply remove the linker script and let the compiler and linker generate a default ELF binary.</p><div class="language-sh-session line-numbers-mode" data-highlighter="prismjs" data-ext="sh-session" data-title="sh-session"><pre><code><span class="line"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">rm</span> src/user/linker.ld</span></span></span>
<span class="line"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">just user</span></span></span>
<span class="line"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">file</span> build/user/utask.bin</span></span></span>
<span class="line"><span class="token output">build/user/utask.bin: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), static-pie linked, not stripped</span>
<span class="line"></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Looks good. Let&#39;s inspect the ELF binary using <code>readelf</code>.</p><div class="language-sh-session line-numbers-mode" data-highlighter="prismjs" data-ext="sh-session" data-title="sh-session"><pre><code><span class="line"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">readelf <span class="token parameter variable">-eW</span> build/user/utask.bin</span></span></span>
<span class="line"><span class="token output">ELF Header:</span>
<span class="line">  Magic:   7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00 </span>
<span class="line">  Class:                             ELF64</span>
<span class="line">  Data:                              2&#39;s complement, little endian</span>
<span class="line">  Version:                           1 (current)</span>
<span class="line">  OS/ABI:                            UNIX - System V</span>
<span class="line">  ABI Version:                       0</span>
<span class="line">  Type:                              DYN (Position-Independent Executable file)</span>
<span class="line">  Machine:                           Advanced Micro Devices X86-64</span>
<span class="line">  Version:                           0x1</span>
<span class="line">  Entry point address:               0xf5f0</span>
<span class="line">  Start of program headers:          64 (bytes into file)</span>
<span class="line">  Start of section headers:          78256 (bytes into file)</span>
<span class="line">  Flags:                             0x0</span>
<span class="line">  Size of this header:               64 (bytes)</span>
<span class="line">  Size of program headers:           56 (bytes)</span>
<span class="line">  Number of program headers:         8</span>
<span class="line">  Size of section headers:           64 (bytes)</span>
<span class="line">  Number of section headers:         18</span>
<span class="line">  Section header string table index: 16</span>
<span class="line"></span>
<span class="line">Section Headers:</span>
<span class="line">  [Nr] Name              Type            Address          Off    Size   ES Flg Lk Inf Al</span>
<span class="line">  [ 0]                   NULL            0000000000000000 000000 000000 00      0   0  0</span>
<span class="line">  [ 1] .dynsym           DYNSYM          0000000000000200 000200 000018 18   A  4   1  8</span>
<span class="line">  [ 2] .gnu.hash         GNU_HASH        0000000000000218 000218 00001c 00   A  1   0  8</span>
<span class="line">  [ 3] .hash             HASH            0000000000000234 000234 000010 04   A  1   0  4</span>
<span class="line">  [ 4] .dynstr           STRTAB          0000000000000244 000244 000001 00   A  0   0  1</span>
<span class="line">  [ 5] .rela.dyn         RELA            0000000000000248 000248 000498 18   A  1   0  8</span>
<span class="line">  [ 6] .rodata           PROGBITS        00000000000006e0 0006e0 000ea8 00 AMS  0   0 16</span>
<span class="line">  [ 7] .text             PROGBITS        0000000000002590 001590 00d712 00  AX  0   0 16</span>
<span class="line">  [ 8] .data.rel.ro      PROGBITS        0000000000010cb0 00ecb0 000270 00  WA  0   0 16</span>
<span class="line">  [ 9] .dynamic          DYNAMIC         0000000000010f20 00ef20 0000d0 10  WA  4   0  8</span>
<span class="line">  [10] .got              PROGBITS        0000000000010ff0 00eff0 000000 00  WA  0   0  8</span>
<span class="line">  [11] .relro_padding    NOBITS          0000000000010ff0 00eff0 000010 00  WA  0   0  1</span>
<span class="line">  [12] .data             PROGBITS        0000000000011ff0 00eff0 000118 00  WA  0   0  8</span>
<span class="line">  [13] .bss              NOBITS          0000000000012110 00f108 200490 00  WA  0   0 16</span>
<span class="line">  [14] .comment          PROGBITS        0000000000000000 00f108 00003e 01  MS  0   0  1</span>
<span class="line">  [15] .symtab           SYMTAB          0000000000000000 00f148 001f38 18     17 332  8</span>
<span class="line">  [16] .shstrtab         STRTAB          0000000000000000 011080 000091 00      0   0  1</span>
<span class="line">  [17] .strtab           STRTAB          0000000000000000 011111 002099 00      0   0  1</span>
<span class="line">Key to Flags:</span>
<span class="line">  W (write), A (alloc), X (execute), M (merge), S (strings), I (info),</span>
<span class="line">  L (link order), O (extra OS processing required), G (group), T (TLS),</span>
<span class="line">  C (compressed), x (unknown), o (OS specific), E (exclude),</span>
<span class="line">  D (mbind), l (large), p (processor specific)</span>
<span class="line"></span>
<span class="line">Program Headers:</span>
<span class="line">  Type           Offset   VirtAddr           PhysAddr           FileSiz  MemSiz   Flg Align</span>
<span class="line">  PHDR           0x000040 0x0000000000000040 0x0000000000000040 0x0001c0 0x0001c0 R   0x8</span>
<span class="line">  LOAD           0x000000 0x0000000000000000 0x0000000000000000 0x001588 0x001588 R   0x1000</span>
<span class="line">  LOAD           0x001590 0x0000000000002590 0x0000000000002590 0x00d712 0x00d712 R E 0x1000</span>
<span class="line">  LOAD           0x00ecb0 0x0000000000010cb0 0x0000000000010cb0 0x000340 0x000350 RW  0x1000</span>
<span class="line">  LOAD           0x00eff0 0x0000000000011ff0 0x0000000000011ff0 0x000118 0x2005b0 RW  0x1000</span>
<span class="line">  DYNAMIC        0x00ef20 0x0000000000010f20 0x0000000000010f20 0x0000d0 0x0000d0 RW  0x8</span>
<span class="line">  GNU_RELRO      0x00ecb0 0x0000000000010cb0 0x0000000000010cb0 0x000340 0x000350 R   0x1</span>
<span class="line">  GNU_STACK      0x000000 0x0000000000000000 0x0000000000000000 0x000000 0x000000 RW  0</span>
<span class="line"></span>
<span class="line"> Section to Segment mapping:</span>
<span class="line">  Segment Sections...</span>
<span class="line">   00     </span>
<span class="line">   01     .dynsym .gnu.hash .hash .dynstr .rela.dyn .rodata </span>
<span class="line">   02     .text </span>
<span class="line">   03     .data.rel.ro .dynamic .relro_padding </span>
<span class="line">   04     .data .bss </span>
<span class="line">   05     .dynamic </span>
<span class="line">   06     .data.rel.ro .dynamic .relro_padding </span>
<span class="line">   07     </span>
<span class="line"></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>We can see there are many sections and several segments. The last part shows how the sections are mapped to the segments. We are mainly interested in the segments of type <code>LOAD</code>, which are the ones to be loaded into memory. We also need the <code>DYNAMIC</code> segment for applying relocations. The nice thing here is that we don&#39;t need to worry about which section is code, data, or bss. The segments include a flags field that tells us the permissions of the segment (read, write, execute). We&#39;ll use this information to set the correct permissions on the virtual memory regions.</p><p>Notice also that the <code>VirtAddr</code> of some segments doesn&#39;t necessarily start on a page boundary. However, their <code>Align</code> field tells us that the first page of the segment should be aligned to a page boundary (I&#39;m making a simplifying assumption here that <code>Align</code> values are always equal to x86-64&#39;s page size, i.e. 4KiB). Thus, a segment&#39;s start page is the segment&#39;s <code>VirtAddr</code> rounded down to the nearest page boundary.</p><h2 id="elf-reader" tabindex="-1"><a class="header-anchor" href="#elf-reader"><span>ELF Reader</span></a></h2><p>To keep the loader simple, we&#39;ll implement a separate ELF reader module that provides an interface to iterate over the sections and segments of an ELF file. Let&#39;s add a new file <code>elf.nim</code> to the <code>kernel</code> directory, which will contain the various types and procedures needed to read an ELF file.</p><p>We&#39;ll start by defining two types: <code>ElfImage</code> and <code>ElfHeader</code>, along with supporting types.</p><div class="language-nim line-numbers-mode" data-highlighter="prismjs" data-ext="nim" data-title="nim"><pre><code><span class="line"><span class="token comment"># src/kernel/elf.nim</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">type</span></span>
<span class="line">  ElfImage <span class="token operator">=</span> <span class="token keyword">object</span></span>
<span class="line">    header<span class="token operator">:</span> <span class="token keyword">ptr</span> ElfHeader</span>
<span class="line"></span>
<span class="line">  ElfHeader <span class="token punctuation">{.</span>packed<span class="token punctuation">.}</span> <span class="token operator">=</span> <span class="token keyword">object</span></span>
<span class="line">    ident<span class="token operator">:</span> ElfIdent</span>
<span class="line">    <span class="token identifier"><span class="token punctuation">\`</span>type<span class="token punctuation">\`</span></span><span class="token operator">:</span> ElfType</span>
<span class="line">    machine<span class="token operator">:</span> ElfMachine</span>
<span class="line">    version<span class="token operator">:</span> uint32</span>
<span class="line">    entry<span class="token operator">:</span> uint64</span>
<span class="line">    phoff<span class="token operator">:</span> uint64</span>
<span class="line">    shoff<span class="token operator">:</span> uint64</span>
<span class="line">    flags<span class="token operator">:</span> uint32</span>
<span class="line">    ehsize<span class="token operator">:</span> uint16</span>
<span class="line">    phentsize<span class="token operator">:</span> uint16</span>
<span class="line">    phnum<span class="token operator">:</span> uint16</span>
<span class="line">    shentsize<span class="token operator">:</span> uint16</span>
<span class="line">    shnum<span class="token operator">:</span> uint16</span>
<span class="line">    shstrndx<span class="token operator">:</span> uint16</span>
<span class="line"></span>
<span class="line">  ElfIdent <span class="token punctuation">{.</span>packed<span class="token punctuation">.}</span> <span class="token operator">=</span> <span class="token keyword">object</span></span>
<span class="line">    magic<span class="token operator">:</span> array<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> char<span class="token punctuation">]</span></span>
<span class="line">    class<span class="token operator">:</span> ElfClass</span>
<span class="line">    endianness<span class="token operator">:</span> ElfEndianness</span>
<span class="line">    version<span class="token operator">:</span> ElfVersion</span>
<span class="line">    osabi<span class="token operator">:</span> uint8</span>
<span class="line">    abiversion<span class="token operator">:</span> uint8</span>
<span class="line">    pad<span class="token operator">:</span> array<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> uint8<span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line">  ElfClass <span class="token operator">=</span> <span class="token keyword">enum</span></span>
<span class="line">    None <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;None&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    Bits32 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;32-bit&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    Bits64 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;64-bit&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">  ElfEndianness <span class="token operator">=</span> <span class="token keyword">enum</span></span>
<span class="line">    None <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;None&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    Little <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;Little-endian&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    Big <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;Big-endian&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">  ElfVersion <span class="token operator">=</span> <span class="token keyword">enum</span></span>
<span class="line">    None <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;None&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    Current <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;Current&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">  ElfType <span class="token punctuation">{.</span>size<span class="token operator">:</span> <span class="token function">sizeof</span><span class="token punctuation">(</span>uint16<span class="token punctuation">)</span><span class="token punctuation">.}</span> <span class="token operator">=</span> <span class="token keyword">enum</span></span>
<span class="line">    None <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;Unknown&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    Relocatable <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;Relocatable&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    Executable <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;Executable&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    Shared <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;Shared object&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    Core <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">&quot;Core&quot;</span><span class="token punctuation">)</span></span>
<span class="line">  </span>
<span class="line">  ElfMachine <span class="token punctuation">{.</span>size<span class="token operator">:</span> <span class="token function">sizeof</span><span class="token punctuation">(</span>uint16<span class="token punctuation">)</span><span class="token punctuation">.}</span> <span class="token operator">=</span> <span class="token keyword">enum</span></span>
<span class="line">    None <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;None&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    Sparc <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0x02</span><span class="token punctuation">,</span> <span class="token string">&quot;Sparc&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    X86 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0x03</span><span class="token punctuation">,</span> <span class="token string">&quot;x86&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    Mips <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0x08</span><span class="token punctuation">,</span> <span class="token string">&quot;MIPS&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    PowerPC <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0x14</span><span class="token punctuation">,</span> <span class="token string">&quot;PowerPC&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    ARM <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0x28</span><span class="token punctuation">,</span> <span class="token string">&quot;Arm&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    Sparc64 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0x2b</span><span class="token punctuation">,</span> <span class="token string">&quot;Sparc64&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    IA64 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0x32</span><span class="token punctuation">,</span> <span class="token string">&quot;IA-64&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    X86_64 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0x3e</span><span class="token punctuation">,</span> <span class="token string">&quot;x86-64&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    AArch64 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0xb7</span><span class="token punctuation">,</span> <span class="token string">&quot;AArch64&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    RiscV <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0xf3</span><span class="token punctuation">,</span> <span class="token string">&quot;RISC-V&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This should be straightforward. The following fields in <code>ElfHeader</code> are relevant to us:</p><ul><li><code>entry</code>: The virtual address of the entry point. We&#39;ll use this to jump to the user task once it&#39;s loaded.</li><li><code>phoff</code>: The offset of the program header table.</li><li><code>phentsize</code>: The size of each entry in the program header table.</li><li><code>phnum</code>: The number of entries in the program header table.</li><li><code>shoff</code>: The offset of the section header table.</li><li><code>shentsize</code>: The size of each entry in the section header table.</li><li><code>shnum</code>: The number of entries in the section header table.</li><li><code>shstrndx</code>: The index of the section header table entry that contains the section names.</li></ul><p>Next, let&#39;s define the <code>ElfProgramHeader</code> type.</p><div class="language-nim line-numbers-mode" data-highlighter="prismjs" data-ext="nim" data-title="nim"><pre><code><span class="line"><span class="token keyword">type</span></span>
<span class="line">  ElfProgramHeader <span class="token punctuation">{.</span>packed<span class="token punctuation">.}</span> <span class="token operator">=</span> <span class="token keyword">object</span></span>
<span class="line">    <span class="token identifier"><span class="token punctuation">\`</span>type<span class="token punctuation">\`</span></span><span class="token operator">:</span> ElfProgramHeaderType</span>
<span class="line">    flags<span class="token operator">:</span> ElfProgramHeaderFlags</span>
<span class="line">    offset<span class="token operator">:</span> uint64</span>
<span class="line">    vaddr<span class="token operator">:</span> uint64</span>
<span class="line">    paddr<span class="token operator">:</span> uint64</span>
<span class="line">    filesz<span class="token operator">:</span> uint64</span>
<span class="line">    memsz<span class="token operator">:</span> uint64</span>
<span class="line">    align<span class="token operator">:</span> uint64</span>
<span class="line"></span>
<span class="line">  ElfProgramHeaderType <span class="token punctuation">{.</span>size<span class="token operator">:</span> <span class="token function">sizeof</span><span class="token punctuation">(</span>uint32<span class="token punctuation">)</span><span class="token punctuation">.}</span> <span class="token operator">=</span> <span class="token keyword">enum</span></span>
<span class="line">    Null <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;NULL&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    Load <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;LOAD&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    Dynamic <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;DYNAMIC&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    Interp <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;INTERP&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    Note <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">&quot;NOTE&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    ShLib <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">&quot;SHLIB&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    Phdr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">&quot;PHDR&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    Tls <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token string">&quot;TLS&quot;</span><span class="token punctuation">)</span></span>
<span class="line">  </span>
<span class="line">  ElfProgramHeaderFlag <span class="token operator">=</span> <span class="token keyword">enum</span></span>
<span class="line">    Executable <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;X&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    Writable   <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;W&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    Readable   <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;R&quot;</span><span class="token punctuation">)</span></span>
<span class="line">  ElfProgramHeaderFlags <span class="token punctuation">{.</span>size<span class="token operator">:</span> <span class="token function">sizeof</span><span class="token punctuation">(</span>uint32<span class="token punctuation">)</span><span class="token punctuation">.}</span> <span class="token operator">=</span> set<span class="token punctuation">[</span>ElfProgramHeaderFlag<span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The <code>ElfProgramHeader</code> type contains the following fields:</p><ul><li><code>type</code>: The type of the segment. We&#39;re only interested in <code>LOAD</code> segments (to be loaded into memory) and <code>DYNAMIC</code> segments (for applying relocations).</li><li><code>flags</code>: The permissions of the segment. We&#39;ll use this to mark the segments as read-only, read-write, or executable.</li><li><code>offset</code>: The offset of the segment in the file.</li><li><code>vaddr</code>: The virtual address of the segment. This is the address where the segment should be loaded into memory relative to the base address.</li><li><code>paddr</code>: The physical address of the segment. This is not used in our case.</li><li><code>filesz</code>: The size of the segment in the file.</li><li><code>memsz</code>: The size of the segment in memory. This can be larger than <code>filesz</code> if the segment contains uninitialized data (e.g. <code>bss</code> section).</li><li><code>align</code>: The alignment of the segment in memory.</li></ul><p>Next, let&#39;s define the <code>ElfSectionHeader</code> type.</p><div class="language-nim line-numbers-mode" data-highlighter="prismjs" data-ext="nim" data-title="nim"><pre><code><span class="line"><span class="token keyword">type</span></span>
<span class="line">  ElfSectionHeader <span class="token punctuation">{.</span>packed<span class="token punctuation">.}</span> <span class="token operator">=</span> <span class="token keyword">object</span></span>
<span class="line">    nameoffset<span class="token operator">:</span> uint32</span>
<span class="line">    <span class="token identifier"><span class="token punctuation">\`</span>type<span class="token punctuation">\`</span></span><span class="token operator">:</span> ElfSectionType</span>
<span class="line">    flags<span class="token operator">:</span> uint64</span>
<span class="line">    vaddr<span class="token operator">:</span> uint64</span>
<span class="line">    offset<span class="token operator">:</span> uint64</span>
<span class="line">    size<span class="token operator">:</span> uint64</span>
<span class="line">    link<span class="token operator">:</span> uint32</span>
<span class="line">    info<span class="token operator">:</span> uint32</span>
<span class="line">    addralign<span class="token operator">:</span> uint64</span>
<span class="line">    entsize<span class="token operator">:</span> uint64</span>
<span class="line">  </span>
<span class="line">  ElfSectionType <span class="token punctuation">{.</span>size<span class="token operator">:</span> <span class="token function">sizeof</span><span class="token punctuation">(</span>uint32<span class="token punctuation">)</span><span class="token punctuation">.}</span> <span class="token operator">=</span> <span class="token keyword">enum</span></span>
<span class="line">    Null <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;NULL&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    ProgBits <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;PROGBITS&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    SymTab <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;SYMTAB&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    StrTab <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;STRTAB&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    Rela <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">&quot;RELA&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    Hash <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">&quot;HASH&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    Dynamic <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">&quot;DYNAMIC&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    Note <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token string">&quot;NOTE&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    NoBits <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">&quot;NOBITS&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    Rel <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token string">&quot;REL&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    ShLib <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">&quot;SHLIB&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    DynSym <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token string">&quot;DYNSYM&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    InitArray <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token string">&quot;INIT_ARRAY&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    FiniArray <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token string">&quot;FINI_ARRAY&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    PreInitArray <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token string">&quot;PREINIT_ARRAY&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    Group <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token string">&quot;GROUP&quot;</span><span class="token punctuation">)</span></span>
<span class="line">    SymTabShndx <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token string">&quot;SYMTAB_SHNDX&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Sections are mostly relevant to the linker, not the loader (which deals with segments). I&#39;m just including it for the sake of completeness.</p><p>Now, let&#39;s add a proc to initialize an <code>ElfImage</code> object from a pointer to the ELF image in memory. We&#39;ll validate some assumptions about the ELF image (e.g. the magic number, the architecture, etc.) and raise an error if the image is not a valid ELF file or if it doesn&#39;t meet our expectations.</p><div class="language-nim line-numbers-mode" data-highlighter="prismjs" data-ext="nim" data-title="nim"><pre><code><span class="line"><span class="token keyword">type</span></span>
<span class="line">  InvalidElfImage <span class="token operator">=</span> <span class="token keyword">object</span> <span class="token operator">of</span> CatchableError</span>
<span class="line">  UnsupportedElfImage <span class="token operator">=</span> <span class="token keyword">object</span> <span class="token operator">of</span> CatchableError</span>
<span class="line"></span>
<span class="line"><span class="token keyword">proc</span> <span class="token function">initElfImage</span><span class="token punctuation">(</span>image<span class="token operator">:</span> pointer<span class="token punctuation">)</span><span class="token operator">:</span> ElfImage <span class="token operator">=</span></span>
<span class="line">  result<span class="token operator">.</span>header <span class="token operator">=</span> <span class="token function">cast[ptr ElfHeader]</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">if</span> result<span class="token operator">.</span>header<span class="token operator">.</span>ident<span class="token operator">.</span>magic <span class="token operator">!=</span> <span class="token punctuation">[</span><span class="token number">0x7f</span><span class="token operator">.</span>char<span class="token punctuation">,</span> <span class="token char">&#39;E&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;L&#39;</span><span class="token punctuation">,</span> <span class="token char">&#39;F&#39;</span><span class="token punctuation">]</span><span class="token operator">:</span></span>
<span class="line">    <span class="token keyword">raise</span> <span class="token function">newException</span><span class="token punctuation">(</span>InvalidElfImage<span class="token punctuation">,</span> <span class="token string">&quot;Not an ELF file&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">if</span> result<span class="token operator">.</span>header<span class="token operator">.</span>ident<span class="token operator">.</span>class <span class="token operator">!=</span> ElfClass<span class="token operator">.</span>Bits64<span class="token operator">:</span></span>
<span class="line">    <span class="token keyword">raise</span> <span class="token function">newException</span><span class="token punctuation">(</span>UnsupportedElfImage<span class="token punctuation">,</span> <span class="token string">&quot;Only 64-bit ELF files are supported&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">if</span> result<span class="token operator">.</span>header<span class="token operator">.</span>ident<span class="token operator">.</span>endianness <span class="token operator">!=</span> ElfEndianness<span class="token operator">.</span>Little<span class="token operator">:</span></span>
<span class="line">    <span class="token keyword">raise</span> <span class="token function">newException</span><span class="token punctuation">(</span>UnsupportedElfImage<span class="token punctuation">,</span> <span class="token string">&quot;Only little-endian ELF files are supported&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">if</span> result<span class="token operator">.</span>header<span class="token operator">.</span>ident<span class="token operator">.</span>version <span class="token operator">!=</span> ElfVersion<span class="token operator">.</span>Current<span class="token operator">:</span></span>
<span class="line">    <span class="token keyword">raise</span> <span class="token function">newException</span><span class="token punctuation">(</span>UnsupportedElfImage<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token string">&quot;Only ELF version {ElfVersion.Current} is supported&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">if</span> result<span class="token operator">.</span>header<span class="token operator">.</span><span class="token keyword">type</span> <span class="token operator">!=</span> ElfType<span class="token operator">.</span>Shared<span class="token operator">:</span></span>
<span class="line">    <span class="token keyword">raise</span> <span class="token function">newException</span><span class="token punctuation">(</span>UnsupportedElfImage<span class="token punctuation">,</span> <span class="token string">&quot;Only position-independent executable ELF files are supported&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">if</span> result<span class="token operator">.</span>header<span class="token operator">.</span>machine <span class="token operator">!=</span> ElfMachine<span class="token operator">.</span>X86_64<span class="token operator">:</span></span>
<span class="line">    <span class="token keyword">raise</span> <span class="token function">newException</span><span class="token punctuation">(</span>UnsupportedElfImage<span class="token punctuation">,</span> <span class="token string">&quot;Only x86-64 ELF files are supported&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Next, let&#39;s add an iterator to iterate over the segments (i.e. program headers) of the ELF image. The iterator will yield a tuple containing the index of the program header and the program header itself.</p><div class="language-nim line-numbers-mode" data-highlighter="prismjs" data-ext="nim" data-title="nim"><pre><code><span class="line"><span class="token keyword">iterator</span> <span class="token function">segments</span><span class="token punctuation">(</span>image<span class="token operator">:</span> ElfImage<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">tuple</span><span class="token punctuation">[</span>i<span class="token operator">:</span> uint16<span class="token punctuation">,</span> ph<span class="token operator">:</span> <span class="token keyword">ptr</span> ElfProgramHeader<span class="token punctuation">]</span> <span class="token operator">=</span></span>
<span class="line">  <span class="token keyword">let</span> header <span class="token operator">=</span> image<span class="token operator">.</span>header</span>
<span class="line"></span>
<span class="line">  <span class="token keyword">let</span> phoff <span class="token operator">=</span> header<span class="token operator">.</span>phoff</span>
<span class="line">  <span class="token keyword">let</span> phentsize <span class="token operator">=</span> header<span class="token operator">.</span>phentsize</span>
<span class="line">  <span class="token keyword">let</span> phnum <span class="token operator">=</span> header<span class="token operator">.</span>phnum</span>
<span class="line"></span>
<span class="line">  <span class="token keyword">for</span> i <span class="token operator">in</span> <span class="token number">0.u</span>int16 <span class="token operator">..&lt;</span> phnum<span class="token operator">:</span></span>
<span class="line">    <span class="token keyword">let</span> ph <span class="token operator">=</span> <span class="token function">cast[ptr ElfProgramHeader]</span><span class="token punctuation">(</span>header <span class="token operator">+!</span> <span class="token punctuation">(</span>phoff <span class="token operator">+</span> phentsize <span class="token operator">*</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token function">yield</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span> ph<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Similarly, let&#39;s add an iterator to iterate over the section headers of the ELF image.</p><div class="language-nim line-numbers-mode" data-highlighter="prismjs" data-ext="nim" data-title="nim"><pre><code><span class="line"><span class="token keyword">iterator</span> <span class="token function">sections</span><span class="token punctuation">(</span>image<span class="token operator">:</span> ElfImage<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">tuple</span><span class="token punctuation">[</span>i<span class="token operator">:</span> uint16<span class="token punctuation">,</span> sh<span class="token operator">:</span> <span class="token keyword">ptr</span> ElfSectionHeader<span class="token punctuation">]</span> <span class="token operator">=</span></span>
<span class="line">  <span class="token keyword">let</span> header <span class="token operator">=</span> image<span class="token operator">.</span>header</span>
<span class="line"></span>
<span class="line">  <span class="token keyword">let</span> shoff <span class="token operator">=</span> header<span class="token operator">.</span>shoff</span>
<span class="line">  <span class="token keyword">let</span> shentsize <span class="token operator">=</span> header<span class="token operator">.</span>shentsize</span>
<span class="line">  <span class="token keyword">let</span> shnum <span class="token operator">=</span> header<span class="token operator">.</span>shnum</span>
<span class="line"></span>
<span class="line">  <span class="token keyword">for</span> i <span class="token operator">in</span> <span class="token number">0.u</span>int16 <span class="token operator">..&lt;</span> shnum<span class="token operator">:</span></span>
<span class="line">    <span class="token keyword">let</span> sh <span class="token operator">=</span> <span class="token function">cast[ptr ElfSectionHeader]</span><span class="token punctuation">(</span>header <span class="token operator">+!</span> <span class="token punctuation">(</span>shoff <span class="token operator">+</span> shentsize <span class="token operator">*</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token function">yield</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span> sh<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>That&#39;s it for the ELF reader. In the next part, we&#39;ll use this module to load the loadable segments of an ELF file into memory, apply relocations, and jump to the entry point.</p>`,33)])])}const c=s(t,[["render",l],["__file","21-elf-loader-p1.html.vue"]]),r=JSON.parse(`{"path":"/osdev/21-elf-loader-p1.html","title":"ELF Loader (Part 1)","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"ELF Format","slug":"elf-format","link":"#elf-format","children":[]},{"level":2,"title":"Building an ELF binary","slug":"building-an-elf-binary","link":"#building-an-elf-binary","children":[]},{"level":2,"title":"ELF Reader","slug":"elf-reader","link":"#elf-reader","children":[]}],"git":{"updatedTime":1744638230000},"filePathRelative":"osdev/21-elf-loader-p1.md","excerpt":"\\n<p>So far we used a flat binary format for our user task. But it's becoming more difficult as\\nwe have to manually specify the layout of the binary using a linker script, and arrange\\nthe sections in a fixed way so that the kernel can load them, apply relocations, and jump\\nto the entry point. We also haven't told the kernel what sections should be marked as\\nread-only, read-write, and/or executable. This is where the ELF format comes in.</p>"}`);export{c as comp,r as data};
